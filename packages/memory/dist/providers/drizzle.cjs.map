{"version":3,"sources":["../../src/providers/drizzle.ts","../../src/providers/drizzle-schema.ts"],"sourcesContent":["import { and, desc, eq, like, or, sql } from \"drizzle-orm\";\r\nimport type {\r\n  ChatSession,\r\n  ConversationMessage,\r\n  MemoryProvider,\r\n  MemoryScope,\r\n  UIMessage,\r\n  WorkingMemory,\r\n} from \"../types.js\";\r\n\r\n/**\r\n * Generic Drizzle table interface for working memory\r\n *\r\n * Uses `any` for column types to support all Drizzle table definitions across\r\n * PostgreSQL, MySQL, and SQLite. This is intentional and necessary for maximum\r\n * flexibility with different database schemas and Drizzle adapters.\r\n */\r\nexport interface WorkingMemoryTable {\r\n  id: any;\r\n  scope: any;\r\n  chatId: any;\r\n  userId: any;\r\n  content: any;\r\n  updatedAt: any;\r\n}\r\n\r\n/**\r\n * Generic Drizzle table interface for conversation messages\r\n *\r\n * Uses `any` for column types to support all Drizzle table definitions across\r\n * PostgreSQL, MySQL, and SQLite. This is intentional and necessary for maximum\r\n * flexibility with different database schemas and Drizzle adapters.\r\n */\r\nexport interface ConversationMessagesTable {\r\n  id: any;\r\n  chatId: any;\r\n  userId: any;\r\n  role: any;\r\n  content: any;\r\n  timestamp: any;\r\n}\r\n\r\n/**\r\n * Generic Drizzle table interface for chat sessions\r\n *\r\n * Uses `any` for column types to support all Drizzle table definitions across\r\n * PostgreSQL, MySQL, and SQLite. This is intentional and necessary for maximum\r\n * flexibility with different database schemas and Drizzle adapters.\r\n */\r\nexport interface ChatsTable {\r\n  chatId: any;\r\n  userId: any;\r\n  title: any;\r\n  createdAt: any;\r\n  updatedAt: any;\r\n  messageCount: any;\r\n}\r\n\r\n/**\r\n * Configuration for Drizzle provider\r\n */\r\nexport interface DrizzleProviderConfig<\r\n  TWM extends WorkingMemoryTable,\r\n  TMsg extends ConversationMessagesTable,\r\n  TChat extends ChatsTable = ChatsTable\r\n> {\r\n  /** Working memory table */\r\n  workingMemoryTable: TWM;\r\n  /** Conversation messages table */\r\n  messagesTable: TMsg;\r\n  /** Chat sessions table (optional) */\r\n  chatsTable?: TChat;\r\n}\r\n\r\n/**\r\n * Drizzle ORM provider - works with PostgreSQL, MySQL, and SQLite\r\n *\r\n * @example\r\n * ```ts\r\n * import { drizzle } from 'drizzle-orm/postgres-js';\r\n * import { createWorkingMemoryTable, createMessagesTable } from '@ai-sdk-tools/memory';\r\n *\r\n * const db = drizzle(client);\r\n * const provider = new DrizzleProvider(db, {\r\n *   workingMemoryTable: createWorkingMemoryTable('working_memory'),\r\n *   messagesTable: createMessagesTable('conversation_messages')\r\n * });\r\n * ```\r\n */\r\nexport class DrizzleProvider<\r\n  TWM extends WorkingMemoryTable,\r\n  TMsg extends ConversationMessagesTable,\r\n  TChat extends ChatsTable = ChatsTable\r\n> implements MemoryProvider\r\n{\r\n  constructor(\r\n    // Accepts any Drizzle database instance (postgres, mysql, sqlite adapters all have different types)\r\n    private db: any,\r\n    private config: DrizzleProviderConfig<TWM, TMsg, TChat>\r\n  ) {}\r\n\r\n  async getWorkingMemory(params: {\r\n    chatId?: string;\r\n    userId?: string;\r\n    scope: MemoryScope;\r\n  }): Promise<WorkingMemory | null> {\r\n    const id = this.getId(params.scope, params.chatId, params.userId);\r\n    const { workingMemoryTable } = this.config;\r\n\r\n    const result = await this.db\r\n      .select()\r\n      .from(workingMemoryTable)\r\n      .where(eq(workingMemoryTable.id, id))\r\n      .limit(1);\r\n\r\n    if (!result.length) return null;\r\n\r\n    const row = result[0];\r\n    return {\r\n      content: row.content,\r\n      updatedAt: new Date(row.updatedAt),\r\n    };\r\n  }\r\n\r\n  async updateWorkingMemory(params: {\r\n    chatId?: string;\r\n    userId?: string;\r\n    scope: MemoryScope;\r\n    content: string;\r\n  }): Promise<void> {\r\n    const id = this.getId(params.scope, params.chatId, params.userId);\r\n    const { workingMemoryTable } = this.config;\r\n\r\n    const now = new Date();\r\n\r\n    // Try to update first\r\n    const existing = await this.db\r\n      .select()\r\n      .from(workingMemoryTable)\r\n      .where(eq(workingMemoryTable.id, id))\r\n      .limit(1);\r\n\r\n    if (existing.length > 0) {\r\n      // Update existing\r\n      await this.db\r\n        .update(workingMemoryTable)\r\n        .set({\r\n          content: params.content,\r\n          updatedAt: now,\r\n        })\r\n        .where(eq(workingMemoryTable.id, id));\r\n    } else {\r\n      // Insert new\r\n      await this.db.insert(workingMemoryTable).values({\r\n        id,\r\n        scope: params.scope,\r\n        chatId: params.chatId || null,\r\n        userId: params.userId || null,\r\n        content: params.content,\r\n        updatedAt: now,\r\n      });\r\n    }\r\n  }\r\n\r\n  async saveMessage(message: ConversationMessage): Promise<void> {\r\n    const { messagesTable } = this.config;\r\n\r\n    await this.db.insert(messagesTable).values({\r\n      chatId: message.chatId,\r\n      userId: message.userId || null,\r\n      role: message.role,\r\n      content: message.content,\r\n      timestamp: message.timestamp,\r\n    });\r\n  }\r\n\r\n  async getMessages<T = UIMessage>(params: {\r\n    chatId: string;\r\n    userId?: string;\r\n    limit?: number;\r\n  }): Promise<T[]> {\r\n    const { messagesTable } = this.config;\r\n\r\n    // Build WHERE conditions\r\n    const whereConditions: ReturnType<typeof eq>[] = [\r\n      eq(messagesTable.chatId, params.chatId),\r\n    ];\r\n\r\n    // Filter by userId if provided\r\n    // Include messages where userId matches OR userId is null (legacy messages)\r\n    if (params.userId) {\r\n      whereConditions.push(\r\n        or(\r\n          eq(messagesTable.userId, params.userId),\r\n          eq(messagesTable.userId, null)\r\n        )!\r\n      );\r\n    }\r\n\r\n    const whereCondition =\r\n      whereConditions.length === 1\r\n        ? whereConditions[0]\r\n        : and(...whereConditions);\r\n\r\n    const result = await this.db\r\n      .select()\r\n      .from(messagesTable)\r\n      .where(whereCondition)\r\n      .orderBy(\r\n        desc(messagesTable.timestamp),\r\n        desc(\r\n          sql`CASE WHEN ${messagesTable.role} = 'assistant' THEN 1 ELSE 0 END`\r\n        )\r\n      )\r\n      .limit(params.limit || 100);\r\n\r\n    return (\r\n      result\r\n        // Drizzle query results have dynamic types based on table schema\r\n        .map((row: any) => {\r\n          let content: string | unknown = row.content;\r\n\r\n          // Always attempt to parse content as JSON\r\n          try {\r\n            if (typeof row.content === \"string\") {\r\n              const parsed = JSON.parse(row.content);\r\n              content = parsed; // Replace content with parsed value\r\n            }\r\n          } catch {\r\n            // If parsing fails, keep original content\r\n          }\r\n\r\n          // Return the content field directly (UIMessage format)\r\n          return content as T;\r\n        })\r\n        .reverse()\r\n    );\r\n  }\r\n\r\n  async saveChat(chat: ChatSession): Promise<void> {\r\n    const { chatsTable } = this.config;\r\n    if (!chatsTable) return;\r\n\r\n    // Check if chat exists\r\n    const existing = await this.db\r\n      .select()\r\n      .from(chatsTable)\r\n      .where(eq(chatsTable.chatId, chat.chatId))\r\n      .limit(1);\r\n\r\n    if (existing.length > 0) {\r\n      // Update existing - preserve title if new chat doesn't have one\r\n      await this.db\r\n        .update(chatsTable)\r\n        .set({\r\n          userId: chat.userId || null,\r\n          title: chat.title || existing[0].title || null,\r\n          updatedAt: chat.updatedAt,\r\n          messageCount: chat.messageCount,\r\n        })\r\n        .where(eq(chatsTable.chatId, chat.chatId));\r\n    } else {\r\n      // Insert new\r\n      await this.db.insert(chatsTable).values({\r\n        chatId: chat.chatId,\r\n        userId: chat.userId || null,\r\n        title: chat.title || null,\r\n        createdAt: chat.createdAt,\r\n        updatedAt: chat.updatedAt,\r\n        messageCount: chat.messageCount,\r\n      });\r\n    }\r\n  }\r\n\r\n  async getChats(params: {\r\n    userId?: string;\r\n    search?: string;\r\n    limit?: number;\r\n  }): Promise<ChatSession[]> {\r\n    const { chatsTable } = this.config;\r\n    if (!chatsTable) return [];\r\n\r\n    // Build WHERE conditions\r\n    const conditions = [];\r\n\r\n    if (params.userId) {\r\n      conditions.push(eq(chatsTable.userId, params.userId));\r\n    }\r\n\r\n    if (params.search) {\r\n      // Use LIKE for case-insensitive search\r\n      // For MySQL/SQLite, we'll handle case-insensitivity in the filter\r\n      conditions.push(like(chatsTable.title, `%${params.search}%`));\r\n    }\r\n\r\n    let query = this.db.select().from(chatsTable);\r\n\r\n    if (conditions.length > 0) {\r\n      const whereCondition =\r\n        conditions.length === 1 ? conditions[0] : and(...conditions);\r\n      query = query.where(whereCondition);\r\n    }\r\n\r\n    // Order by updatedAt descending (most recent first)\r\n    query = query.orderBy(desc(chatsTable.updatedAt));\r\n\r\n    // Apply limit at database level (most efficient)\r\n    if (params.limit) {\r\n      query = query.limit(params.limit);\r\n    }\r\n\r\n    const result = await query;\r\n\r\n    let chats = result.map((row: any) => ({\r\n      chatId: row.chatId,\r\n      userId: row.userId || undefined,\r\n      title: row.title || undefined,\r\n      createdAt: new Date(row.createdAt),\r\n      updatedAt: new Date(row.updatedAt),\r\n      messageCount: row.messageCount,\r\n    }));\r\n\r\n    // For MySQL/SQLite, apply case-insensitive filter if search was used\r\n    // (PostgreSQL ILIKE handles it, but LIKE doesn't)\r\n    if (params.search) {\r\n      const searchLower = params.search.toLowerCase();\r\n      chats = chats.filter((chat: ChatSession) =>\r\n        chat.title?.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    return chats;\r\n  }\r\n\r\n  async getChat(chatId: string): Promise<ChatSession | null> {\r\n    const { chatsTable } = this.config;\r\n    if (!chatsTable) return null;\r\n\r\n    const result = await this.db\r\n      .select()\r\n      .from(chatsTable)\r\n      .where(eq(chatsTable.chatId, chatId))\r\n      .limit(1);\r\n\r\n    if (!result.length) return null;\r\n\r\n    const row = result[0];\r\n    return {\r\n      chatId: row.chatId,\r\n      userId: row.userId || undefined,\r\n      title: row.title || undefined,\r\n      createdAt: new Date(row.createdAt),\r\n      updatedAt: new Date(row.updatedAt),\r\n      messageCount: row.messageCount,\r\n    };\r\n  }\r\n\r\n  async updateChatTitle(chatId: string, title: string): Promise<void> {\r\n    const { chatsTable } = this.config;\r\n    if (!chatsTable) return;\r\n\r\n    // Check if chat exists\r\n    const existing = await this.db\r\n      .select()\r\n      .from(chatsTable)\r\n      .where(eq(chatsTable.chatId, chatId))\r\n      .limit(1);\r\n\r\n    if (existing.length > 0) {\r\n      // Chat exists, update it\r\n      await this.db\r\n        .update(chatsTable)\r\n        .set({\r\n          title,\r\n          updatedAt: new Date(),\r\n        })\r\n        .where(eq(chatsTable.chatId, chatId));\r\n    } else {\r\n      // Chat doesn't exist yet, create it with the title\r\n      // This can happen if title generation completes before the chat is saved\r\n      await this.saveChat({\r\n        chatId,\r\n        title,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n        messageCount: 0,\r\n      });\r\n    }\r\n  }\r\n\r\n  async deleteChat(chatId: string): Promise<void> {\r\n    const { chatsTable, messagesTable } = this.config;\r\n\r\n    // Delete messages first (if messagesTable exists)\r\n    if (messagesTable) {\r\n      await this.db\r\n        .delete(messagesTable)\r\n        .where(eq(messagesTable.chatId, chatId));\r\n    }\r\n\r\n    // Delete chat (if chatsTable exists)\r\n    if (chatsTable) {\r\n      await this.db.delete(chatsTable).where(eq(chatsTable.chatId, chatId));\r\n    }\r\n  }\r\n\r\n  private getId(scope: MemoryScope, chatId?: string, userId?: string): string {\r\n    const id = scope === \"chat\" ? chatId : userId;\r\n    return `${scope}:${id}`;\r\n  }\r\n}\r\n\r\n// Re-export schema helpers under drizzle subpath\r\nexport {\r\n  createMysqlChatsSchema,\r\n  createMysqlMessagesSchema,\r\n  createMysqlWorkingMemorySchema,\r\n  createPgChatsSchema,\r\n  createPgMessagesSchema,\r\n  createPgWorkingMemorySchema,\r\n  createSqliteChatsSchema,\r\n  createSqliteMessagesSchema,\r\n  createSqliteWorkingMemorySchema,\r\n  SQL_SCHEMAS,\r\n} from \"./drizzle-schema.js\";\r\n","/**\r\n * Schema helpers for Drizzle provider\r\n *\r\n * These helpers make it easy to create compatible table schemas\r\n * for any database backend (PostgreSQL, MySQL, SQLite).\r\n *\r\n * Note: These functions use `any` types because they accept Drizzle's\r\n * table builder objects which have different types for each database.\r\n * This is intentional to support all database backends.\r\n */\r\n\r\n// PostgreSQL Schema Helpers\r\n/**\r\n * Create a working memory table schema for PostgreSQL\r\n *\r\n * @example\r\n * ```ts\r\n * import { pgTable } from 'drizzle-orm/pg-core';\r\n * import { createPgWorkingMemorySchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const workingMemory = pgTable('working_memory', createPgWorkingMemorySchema());\r\n * ```\r\n */\r\nexport function createPgWorkingMemorySchema() {\r\n  // Import types will be resolved at runtime by user\r\n  // This returns the schema object that works with pgTable\r\n  return {\r\n    id: (t: any) => t.text(\"id\").primaryKey(),\r\n    scope: (t: any) => t.text(\"scope\").notNull(),\r\n    chatId: (t: any) => t.text(\"chat_id\"),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    updatedAt: (t: any) => t.timestamp(\"updated_at\").notNull(),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a conversation messages table schema for PostgreSQL\r\n *\r\n * @example\r\n * ```ts\r\n * import { pgTable, serial } from 'drizzle-orm/pg-core';\r\n * import { createPgMessagesSchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const messages = pgTable('conversation_messages', createPgMessagesSchema());\r\n * ```\r\n */\r\nexport function createPgMessagesSchema() {\r\n  return {\r\n    id: (t: any) => t.serial(\"id\").primaryKey(),\r\n    chatId: (t: any) => t.text(\"chat_id\").notNull(),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    role: (t: any) => t.text(\"role\").notNull(),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    timestamp: (t: any) => t.timestamp(\"timestamp\").notNull(),\r\n  };\r\n}\r\n\r\n// MySQL Schema Helpers\r\n/**\r\n * Create a working memory table schema for MySQL\r\n *\r\n * @example\r\n * ```ts\r\n * import { mysqlTable } from 'drizzle-orm/mysql-core';\r\n * import { createMysqlWorkingMemorySchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const workingMemory = mysqlTable('working_memory', createMysqlWorkingMemorySchema());\r\n * ```\r\n */\r\nexport function createMysqlWorkingMemorySchema() {\r\n  return {\r\n    id: (t: any) => t.varchar(\"id\", { length: 255 }).primaryKey(),\r\n    scope: (t: any) => t.varchar(\"scope\", { length: 50 }).notNull(),\r\n    chatId: (t: any) => t.varchar(\"chat_id\", { length: 255 }),\r\n    userId: (t: any) => t.varchar(\"user_id\", { length: 255 }),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    updatedAt: (t: any) => t.timestamp(\"updated_at\").notNull(),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a conversation messages table schema for MySQL\r\n */\r\nexport function createMysqlMessagesSchema() {\r\n  return {\r\n    id: (t: any) => t.int(\"id\").primaryKey().autoincrement(),\r\n    chatId: (t: any) => t.varchar(\"chat_id\", { length: 255 }).notNull(),\r\n    userId: (t: any) => t.varchar(\"user_id\", { length: 255 }),\r\n    role: (t: any) => t.varchar(\"role\", { length: 50 }).notNull(),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    timestamp: (t: any) => t.timestamp(\"timestamp\").notNull(),\r\n  };\r\n}\r\n\r\n// SQLite Schema Helpers\r\n/**\r\n * Create a working memory table schema for SQLite\r\n *\r\n * @example\r\n * ```ts\r\n * import { sqliteTable } from 'drizzle-orm/sqlite-core';\r\n * import { createSqliteWorkingMemorySchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const workingMemory = sqliteTable('working_memory', createSqliteWorkingMemorySchema());\r\n * ```\r\n */\r\nexport function createSqliteWorkingMemorySchema() {\r\n  return {\r\n    id: (t: any) => t.text(\"id\").primaryKey(),\r\n    scope: (t: any) => t.text(\"scope\").notNull(),\r\n    chatId: (t: any) => t.text(\"chat_id\"),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    updatedAt: (t: any) =>\r\n      t.integer(\"updated_at\", { mode: \"timestamp\" }).notNull(),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a conversation messages table schema for SQLite\r\n */\r\nexport function createSqliteMessagesSchema() {\r\n  return {\r\n    id: (t: any) => t.integer(\"id\").primaryKey({ autoIncrement: true }),\r\n    chatId: (t: any) => t.text(\"chat_id\").notNull(),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    role: (t: any) => t.text(\"role\").notNull(),\r\n    content: (t: any) => t.text(\"content\").notNull(),\r\n    timestamp: (t: any) =>\r\n      t.integer(\"timestamp\", { mode: \"timestamp\" }).notNull(),\r\n  };\r\n}\r\n\r\n// Chat Sessions Schema Helpers\r\n\r\n/**\r\n * Create a chat sessions table schema for PostgreSQL\r\n *\r\n * @example\r\n * ```ts\r\n * import { pgTable } from 'drizzle-orm/pg-core';\r\n * import { createPgChatsSchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const chats = pgTable('chat_sessions', createPgChatsSchema());\r\n * ```\r\n */\r\nexport function createPgChatsSchema() {\r\n  return {\r\n    chatId: (t: any) => t.text(\"chat_id\").primaryKey(),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    title: (t: any) => t.text(\"title\"),\r\n    createdAt: (t: any) => t.timestamp(\"created_at\").notNull(),\r\n    updatedAt: (t: any) => t.timestamp(\"updated_at\").notNull(),\r\n    messageCount: (t: any) => t.integer(\"message_count\").notNull().default(0),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a chat sessions table schema for MySQL\r\n *\r\n * @example\r\n * ```ts\r\n * import { mysqlTable } from 'drizzle-orm/mysql-core';\r\n * import { createMysqlChatsSchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const chats = mysqlTable('chat_sessions', createMysqlChatsSchema());\r\n * ```\r\n */\r\nexport function createMysqlChatsSchema() {\r\n  return {\r\n    chatId: (t: any) => t.varchar(\"chat_id\", { length: 255 }).primaryKey(),\r\n    userId: (t: any) => t.varchar(\"user_id\", { length: 255 }),\r\n    title: (t: any) => t.varchar(\"title\", { length: 500 }),\r\n    createdAt: (t: any) => t.timestamp(\"created_at\").notNull(),\r\n    updatedAt: (t: any) => t.timestamp(\"updated_at\").notNull(),\r\n    messageCount: (t: any) => t.int(\"message_count\").notNull().default(0),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a chat sessions table schema for SQLite\r\n *\r\n * @example\r\n * ```ts\r\n * import { sqliteTable } from 'drizzle-orm/sqlite-core';\r\n * import { createSqliteChatsSchema } from '@ai-sdk-tools/memory/drizzle';\r\n *\r\n * export const chats = sqliteTable('chat_sessions', createSqliteChatsSchema());\r\n * ```\r\n */\r\nexport function createSqliteChatsSchema() {\r\n  return {\r\n    chatId: (t: any) => t.text(\"chat_id\").primaryKey(),\r\n    userId: (t: any) => t.text(\"user_id\"),\r\n    title: (t: any) => t.text(\"title\"),\r\n    createdAt: (t: any) =>\r\n      t.integer(\"created_at\", { mode: \"timestamp\" }).notNull(),\r\n    updatedAt: (t: any) =>\r\n      t.integer(\"updated_at\", { mode: \"timestamp\" }).notNull(),\r\n    messageCount: (t: any) => t.integer(\"message_count\").notNull().default(0),\r\n  };\r\n}\r\n\r\n/**\r\n * Example SQL for manual schema creation\r\n */\r\nexport const SQL_SCHEMAS = {\r\n  postgresql: {\r\n    workingMemory: `\r\n      CREATE TABLE IF NOT EXISTS working_memory (\r\n        id TEXT PRIMARY KEY,\r\n        scope TEXT NOT NULL,\r\n        chat_id TEXT,\r\n        user_id TEXT,\r\n        content TEXT NOT NULL,\r\n        updated_at TIMESTAMP NOT NULL DEFAULT NOW()\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_working_memory_scope ON working_memory(scope, chat_id, user_id);\r\n    `,\r\n    messages: `\r\n      CREATE TABLE IF NOT EXISTS conversation_messages (\r\n        id SERIAL PRIMARY KEY,\r\n        chat_id TEXT NOT NULL,\r\n        user_id TEXT,\r\n        role TEXT NOT NULL,\r\n        content TEXT NOT NULL,\r\n        timestamp TIMESTAMP NOT NULL DEFAULT NOW()\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_messages_chat ON conversation_messages(chat_id, timestamp DESC);\r\n    `,\r\n    chats: `\r\n      CREATE TABLE IF NOT EXISTS chat_sessions (\r\n        chat_id TEXT PRIMARY KEY,\r\n        user_id TEXT,\r\n        title TEXT,\r\n        created_at TIMESTAMP NOT NULL DEFAULT NOW(),\r\n        updated_at TIMESTAMP NOT NULL DEFAULT NOW(),\r\n        message_count INTEGER NOT NULL DEFAULT 0\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_chats_user ON chat_sessions(user_id, updated_at DESC);\r\n    `,\r\n  },\r\n  mysql: {\r\n    workingMemory: `\r\n      CREATE TABLE IF NOT EXISTS working_memory (\r\n        id VARCHAR(255) PRIMARY KEY,\r\n        scope VARCHAR(50) NOT NULL,\r\n        chat_id VARCHAR(255),\r\n        user_id VARCHAR(255),\r\n        content TEXT NOT NULL,\r\n        updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\r\n      );\r\n      CREATE INDEX idx_working_memory_scope ON working_memory(scope, chat_id, user_id);\r\n    `,\r\n    messages: `\r\n      CREATE TABLE IF NOT EXISTS conversation_messages (\r\n        id INT PRIMARY KEY AUTO_INCREMENT,\r\n        chat_id VARCHAR(255) NOT NULL,\r\n        user_id VARCHAR(255),\r\n        role VARCHAR(50) NOT NULL,\r\n        content TEXT NOT NULL,\r\n        timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\r\n      );\r\n      CREATE INDEX idx_messages_chat ON conversation_messages(chat_id, timestamp DESC);\r\n    `,\r\n    chats: `\r\n      CREATE TABLE IF NOT EXISTS chat_sessions (\r\n        chat_id VARCHAR(255) PRIMARY KEY,\r\n        user_id VARCHAR(255),\r\n        title VARCHAR(500),\r\n        created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\r\n        message_count INT NOT NULL DEFAULT 0\r\n      );\r\n      CREATE INDEX idx_chats_user ON chat_sessions(user_id, updated_at DESC);\r\n    `,\r\n  },\r\n  sqlite: {\r\n    workingMemory: `\r\n      CREATE TABLE IF NOT EXISTS working_memory (\r\n        id TEXT PRIMARY KEY,\r\n        scope TEXT NOT NULL,\r\n        chat_id TEXT,\r\n        user_id TEXT,\r\n        content TEXT NOT NULL,\r\n        updated_at INTEGER NOT NULL\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_working_memory_scope ON working_memory(scope, chat_id, user_id);\r\n    `,\r\n    messages: `\r\n      CREATE TABLE IF NOT EXISTS conversation_messages (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        chat_id TEXT NOT NULL,\r\n        user_id TEXT,\r\n        role TEXT NOT NULL,\r\n        content TEXT NOT NULL,\r\n        timestamp INTEGER NOT NULL\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_messages_chat ON conversation_messages(chat_id, timestamp DESC);\r\n    `,\r\n    chats: `\r\n      CREATE TABLE IF NOT EXISTS chat_sessions (\r\n        chat_id TEXT PRIMARY KEY,\r\n        user_id TEXT,\r\n        title TEXT,\r\n        created_at INTEGER NOT NULL,\r\n        updated_at INTEGER NOT NULL,\r\n        message_count INTEGER NOT NULL DEFAULT 0\r\n      );\r\n      CREATE INDEX IF NOT EXISTS idx_chats_user ON chat_sessions(user_id, updated_at DESC);\r\n    `,\r\n  },\r\n} as const;\r\n"],"mappings":"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","names":[]}