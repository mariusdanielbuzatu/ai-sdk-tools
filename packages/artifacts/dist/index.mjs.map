{"version":3,"sources":["../src/streaming.ts","../src/utils.ts","../src/artifact.ts","../src/context.ts","../src/types.ts"],"sourcesContent":["import type { UIMessageStreamWriter } from \"ai\";\r\nimport type { ArtifactConfig, ArtifactData } from \"./types\";\r\n\r\nexport class StreamingArtifact<T> {\r\n  private config: ArtifactConfig<T>;\r\n  private instance: ArtifactData<T>;\r\n  private writer: UIMessageStreamWriter;\r\n\r\n  constructor(\r\n    config: ArtifactConfig<T>,\r\n    instance: ArtifactData<T>,\r\n    writer: UIMessageStreamWriter,\r\n  ) {\r\n    this.config = config;\r\n    this.instance = instance;\r\n    this.writer = writer;\r\n\r\n    // Send initial state\r\n    this.stream();\r\n  }\r\n\r\n  get data(): T {\r\n    return this.instance.payload;\r\n  }\r\n\r\n  get id(): string {\r\n    return this.instance.id;\r\n  }\r\n\r\n  get progress(): number | undefined {\r\n    return this.instance.progress;\r\n  }\r\n\r\n  set progress(value: number | undefined) {\r\n    this.instance.progress = value;\r\n    this.instance.updatedAt = Date.now();\r\n    this.stream();\r\n  }\r\n\r\n  async update(updates: Partial<T> & { progress?: number }): Promise<void> {\r\n    if (\"progress\" in updates) {\r\n      this.instance.progress = updates.progress;\r\n      delete (updates as Record<string, unknown>).progress; // Remove progress from payload updates\r\n    }\r\n\r\n    this.instance.payload = { ...this.instance.payload, ...updates };\r\n    this.instance.status = \"streaming\";\r\n    this.instance.version++;\r\n    this.instance.updatedAt = Date.now();\r\n    this.stream();\r\n  }\r\n\r\n  async complete(finalData?: T): Promise<void> {\r\n    if (finalData) {\r\n      this.instance.payload = finalData;\r\n    }\r\n    this.instance.status = \"complete\";\r\n    this.instance.progress = 1;\r\n    this.instance.version++;\r\n    this.instance.updatedAt = Date.now();\r\n    this.stream();\r\n  }\r\n\r\n  async error(message: string): Promise<void> {\r\n    this.instance.status = \"error\";\r\n    this.instance.error = message;\r\n    this.instance.version++;\r\n    this.instance.updatedAt = Date.now();\r\n    this.stream();\r\n  }\r\n\r\n  async cancel(): Promise<void> {\r\n    this.instance.status = \"error\";\r\n    this.instance.error = \"Artifact was cancelled\";\r\n    this.instance.version++;\r\n    this.instance.updatedAt = Date.now();\r\n    this.stream();\r\n  }\r\n\r\n  timeout(ms: number): void {\r\n    setTimeout(() => {\r\n      if (\r\n        this.instance.status === \"loading\" ||\r\n        this.instance.status === \"streaming\"\r\n      ) {\r\n        this.error(`Artifact timed out after ${ms}ms`);\r\n      }\r\n    }, ms);\r\n  }\r\n\r\n  private stream(): void {\r\n    this.writer.write({\r\n      type: `data-artifact-${this.config.id}`,\r\n      id: this.instance.id,\r\n      data: this.instance,\r\n    });\r\n  }\r\n}\r\n","import { generateId as generateIdAi } from \"ai\";\r\nimport type { z } from \"zod\";\r\n\r\nexport function generateId(): string {\r\n  return `artifact_${Date.now()}_${generateIdAi()}`;\r\n}\r\n\r\nexport function getDefaults<T>(schema: z.ZodSchema<T>): Partial<T> {\r\n  try {\r\n    return schema.parse({});\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n","import type { UIMessageStreamWriter } from \"ai\";\r\nimport type { z } from \"zod\";\r\nimport { StreamingArtifact } from \"./streaming\";\r\nimport type { ArtifactConfig, ArtifactData } from \"./types\";\r\nimport { generateId, getDefaults } from \"./utils\";\r\n\r\nexport function artifact<T>(id: string, schema: z.ZodSchema<T>) {\r\n  const config: ArtifactConfig<T> = { id, schema };\r\n\r\n  return {\r\n    id,\r\n    schema,\r\n\r\n    create(data: Partial<T> = {}): ArtifactData<T> {\r\n      const defaults = getDefaults(schema);\r\n      const validated = schema.parse({ ...defaults, ...data });\r\n\r\n      return {\r\n        id: generateId(),\r\n        type: id,\r\n        status: \"idle\",\r\n        payload: validated,\r\n        version: 1,\r\n        createdAt: Date.now(),\r\n        updatedAt: Date.now(),\r\n      };\r\n    },\r\n\r\n    stream(\r\n      data: Partial<T>,\r\n      writer: UIMessageStreamWriter,\r\n    ): StreamingArtifact<T> {\r\n      const instance = this.create(data);\r\n      instance.status = \"loading\";\r\n      return new StreamingArtifact(config, instance, writer);\r\n    },\r\n\r\n    validate(data: unknown): T {\r\n      return schema.parse(data);\r\n    },\r\n\r\n    isValid(data: unknown): data is T {\r\n      try {\r\n        schema.parse(data);\r\n        return true;\r\n      } catch {\r\n        return false;\r\n      }\r\n    },\r\n  };\r\n}\r\n","/**\r\n * Artifacts Writer Access\r\n *\r\n * Provides access to the stream writer from tool executionOptions.\r\n * The writer is needed to stream artifact updates to the client.\r\n *\r\n */\r\n\r\nimport type { UIMessageStreamWriter } from \"ai\";\r\n\r\n/**\r\n * Get writer from execution context\r\n *\r\n * @param executionOptions - Tool execution options from AI SDK\r\n * @returns The stream writer\r\n *\r\n * @example\r\n * ```typescript\r\n * export const myTool = tool({\r\n *   execute: async (params, executionOptions) => {\r\n *     const writer = getWriter(executionOptions);\r\n *     const artifact = MyArtifact.stream(data, writer);\r\n *   }\r\n * });\r\n * ```\r\n */\r\nexport function getWriter(executionOptions?: any): UIMessageStreamWriter {\r\n  // AI SDK passes context via experimental_context\r\n  const writer = executionOptions?.experimental_context?.writer;\r\n\r\n  if (!writer) {\r\n    throw new Error(\r\n      \"Writer not available. Make sure you're passing executionOptions: getWriter(executionOptions)\",\r\n    );\r\n  }\r\n\r\n  return writer;\r\n}\r\n","import type { z } from \"zod\";\r\n\r\nexport type ArtifactStatus =\r\n  | \"idle\"\r\n  | \"loading\"\r\n  | \"streaming\"\r\n  | \"complete\"\r\n  | \"error\";\r\n\r\nexport class ArtifactError extends Error {\r\n  constructor(\r\n    public code: string,\r\n    message: string,\r\n  ) {\r\n    super(message);\r\n    this.name = \"ArtifactError\";\r\n  }\r\n}\r\n\r\nexport interface ArtifactData<T = unknown> {\r\n  id: string;\r\n  type: string;\r\n  status: ArtifactStatus;\r\n  payload: T;\r\n  version: number;\r\n  progress?: number;\r\n  error?: string;\r\n  createdAt: number;\r\n  updatedAt: number;\r\n}\r\n\r\nexport interface ArtifactConfig<T = unknown> {\r\n  id: string;\r\n  schema: z.ZodSchema<T>;\r\n}\r\n\r\nexport interface ArtifactStreamPart<T = unknown> {\r\n  type: `data-artifact-${string}`;\r\n  id: string;\r\n  data: ArtifactData<T>;\r\n}\r\n\r\nexport interface ArtifactCallbacks<T = unknown> {\r\n  onUpdate?: (data: T, prevData: T | null) => void;\r\n  onComplete?: (data: T) => void;\r\n  onError?: (error: string, data: T | null) => void;\r\n  onProgress?: (progress: number, data: T) => void;\r\n  onStatusChange?: (status: ArtifactStatus, prevStatus: ArtifactStatus) => void;\r\n}\r\n\r\nexport interface UseArtifactOptions<T = unknown> extends ArtifactCallbacks<T> {\r\n  version?: number;\r\n}\r\n\r\nexport interface UseArtifactReturn<T = unknown> {\r\n  data: T | null;\r\n  status: ArtifactStatus;\r\n  progress?: number;\r\n  error?: string;\r\n  isActive: boolean;\r\n  hasData: boolean;\r\n  versions: ArtifactData<T>[];\r\n  currentIndex?: number;\r\n}\r\n\r\nexport interface UseArtifactActions {\r\n  delete: (artifactId: string) => void;\r\n}\r\n\r\nexport interface UseArtifactsOptions {\r\n  onData?: (artifactType: string, data: ArtifactData<unknown>) => void;\r\n  storeId?: string;\r\n  include?: string[]; // Only listen to these artifact types\r\n  exclude?: string[]; // Ignore these artifact types\r\n  value?: string | null; // Optional: externally controlled active type\r\n  onChange?: (value: string | null) => void; // Optional: callback when active type changes\r\n  dismissed?: string[]; // Optional: externally controlled dismissed types\r\n  onDismissedChange?: (dismissed: string[]) => void; // Optional: callback when dismissed types change\r\n}\r\n\r\nexport interface UseArtifactsReturn {\r\n  byType: Record<string, ArtifactData<unknown>[]>;\r\n  latestByType: Record<string, ArtifactData<unknown>>;\r\n  artifacts: ArtifactData<unknown>[];\r\n  current: ArtifactData<unknown> | null;\r\n  activeType: string | null;\r\n  activeArtifacts: ArtifactData<unknown>[];\r\n  types: string[];\r\n  latestArtifactType: string | null;\r\n  available: string[];\r\n  dismissed: string[];\r\n}\r\n\r\nexport interface UseArtifactsActions {\r\n  setValue: (value: string | null) => void;\r\n  dismiss: (type: string) => void;\r\n  restore: (type: string) => void;\r\n}\r\n"],"mappings":"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","names":[]}